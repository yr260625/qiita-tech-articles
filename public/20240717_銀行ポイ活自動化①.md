---
title: '銀行ポイ活自動化でひと月1,000円稼ぐ方法①'
tags:
  - Python
  - Selenium
  - 銀行振込
private: true
updated_at: '2024-08-01T01:25:38+09:00'
id: 7e9d011d02bf8d3d98ab
organization_url_name: null
slide: false
ignorePublish: false
---
## はじめに

本記事では、以下の内容について記載します。
* 銀行口座間の振込によるポイ活
* selenium を用いた振込作業の自動化

## 経緯

銀行名は伏せますが、被振込でポイントをいくらか獲得できる銀行があります。概要は以下の通りです。
* 10,000 円以上の被振込1回につき20ポイント獲得
* ひと月に最大25回まで獲得可能
* 銀行B、Cの定額自動入金はポイント付与の対象外

    ![01.銀行自動振込_概要.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1681290/69fc83ec-dfed-1d1c-4d20-2919d0a99632.png)

銀行Aから銀行B、Cへの振込手数料は今のところ無料です。つまり以下の手続きを踏めば、ひと月で1,000円の儲けになります。

1. 銀行Aから銀行B、Cに1万円ずつの振込を25回行う。
2. 銀行B、Cから銀行Aに25万円戻す。(定額自動振込でOK)

ただしこれを手動で行うのは非常に手間です。振込1回で行う作業は以下の通りです。

1. 振込元の銀行Aのアカウントにログイン
2. 取引ページに遷移
3. 振込実行
4. 認証実行
5. 振込結果参照

大体3分ぐらいかかる感じです。ひと月に25回もやるのは面倒すぎるというわけで、**自動化して楽に1,000円稼ごう**、をモチベーションに作成しました。


## この記事の対象者

* selenium を使ってブラウザの自動操作を試したい人
* 銀行ポイ活を始めたい人

## 製造前に確認するべきこと

### 規約上問題ないかどうか確認する

利用規約を熟読して自動アクセスを行っても問題ないかどうか確認しておくことをお勧めします。（違法行為にならないように注意）

### サーバーに与える負荷を軽減する

短時間に大量のアクセスを行うと、Webサーバーに極度の負荷がかかる可能性があります。リクエスト間隔は十分に空けておくことを心がけましょう。今回採用した方法として、各関数に以下のようなデコレータを仕込み、リクエスト実行前に5~10秒待機させました。

```python
def wait_random_time(func: Callable) -> Callable:
    @wraps(func)
    def wrapper(*args: Any, **kwargs: Any) -> Any:
        wait_time = round(random.uniform(5, 10), 1)
        print(f"Calling {func.__name__}...")
        time.sleep(wait_time)
        return func(*args, **kwargs)
    return wrapper

@wait_random_time
def some_request():
  # 処理実行前に5~10秒待機する
  pass
```

### 1日に複数回の振込は控える

ただの推測ですが1日で25回もの振込をすれば、怪しい取引とみなされるのではないかなと。念のために1実行1振込となるようにしました。(口座利用の停止措置などは食らいたくないので)

## 環境構築

Windowsに構築することを想定して記載します。

### 1. Pythonをインストール

↓こちらからインストーラーをダウンロードして実行してください。

https://www.python.org/downloads/windows/

私のPCには既に3.10のバージョンがインストールされているので、これを使用します。

![銀行ポイ活自動化①_pythonバージョン.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1681290/f4f0e2c9-8905-c3bf-d0cd-b0db9baf8c21.png)

### 2. 仮想環境構築

本アプリ専用に独立した仮想環境を構築します。コマンドプロンプトを起動し、以下のコマンドを実行します。パスやフォルダ名は好きなようにしてください。

```bat
cd [任意のパス]
mkdir [任意のフォルダ名]
cd [任意のフォルダ名]
python -m venv .venv
```

### 3. モジュール追加

仮想環境をアクティベートした状態で、必要なモジュールを追加します。これでひとまず準備完了です。

```bat
.venv\Scripts\activate
pip install selenium==4.22.0
pip install python-dotenv==1.0.1
```

#### Selenium

ブラウザ操作を自動化するために使用します。これから作るアプリでは中心的な役割を持ちます。

#### python-dotenv

Pythonアプリケーション内で環境変数ファイル(.env)を読み込むために使用します。銀行にログインするときに必要なIDやパスワードをハードコーディングをせずに、環境変数ファイル(.env)に保持することにしました。（セキュリティ的にどうなのかという疑問は残りますが、とりあえず放置）

## 処理の流れ

基本的なフローとしては以下のようになります。

1. Webブラウザ操作用のドライバーを作成
2. 振込元銀行のマイページにログイン
3. 取引ページに遷移
4. 振込実行
5. 認証実行

### 1. ドライバ作成

ブラウザ操作を行うためのドライバーを生成します。いろいろオプションはあるようですが、今回は以下のようにします。
* ユーザーエージェントは設定ファイルに記載した配列からランダムに選択
* 余分なログ出力を抑制
* 処理終了後にブラウザを閉じない

```python:src/main.py
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.remote.webdriver import WebDriver

def create_driver(config: Dict[str, Any]) -> WebDriver:
    options = Options()
    options.add_argument("--user-agent=" + random.choice(config["ua_list"]))
    options.add_experimental_option("excludeSwitches", ["enable-logging"])
    options.add_experimental_option("detach", True)
    return webdriver.Chrome(service=Service(), options=options)
```

### 2. ログイン

ログイン処理は以下の流れで行います。
1. デコレータを付与してランダム時間を待機
2. 入力要素を検索
   * `WebDriverWait`を使用して要素が現れるまで待機する
   * デベロッパーツールからHTML要素を確認し、探しやすい方法で探せばよい
4. submit用のボタン要素を検索
5. ボタンをクリック

```python:src/bank_transfer_automation.py
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class BankTransferAutomation:
    @wait_random_time
    def login(self, login_url: str, kaiin_no: str, password: str) -> None:
        # ログインページにアクセス
        self.driver.get(login_url)

        # 会員番号
        kaiin_no_element = WebDriverWait(self.driver, self.wait_time).until(
            EC.presence_of_element_located((By.NAME, "kaiinNo"))
        )
        kaiin_no_element.send_keys(kaiin_no)

        # ログインパスワード
        password_element = WebDriverWait(self.driver, self.wait_time).until(
            EC.presence_of_element_located((By.NAME, "ibpassword"))
        )
        password_element.send_keys(password)

        # ログイン実行
        login_button_element = WebDriverWait(self.driver, self.wait_time).until(
            EC.presence_of_element_located(
                (By.XPATH, '//input[@type="button" and contains(@value, "ログイン")]')
            )
        )
        login_button_element.click()
```

### 3. その他処理

振込までに必要な処理はログインと同じ要領で実施できます。つまりは、
1. 操作する要素を適切なキーワードで検索
2. 検索した要素に入力や押下など適切な操作を行う

この手順で以下の作業も同様に行います。
* 取引ページに遷移
* 振込実行
* 認証実行
* 振込結果参照

## 実行

フォルダ構成はこんな感じにしました。

```
$ tree
.
|-- .env                             // 環境変数
|-- config.json                      // 設定ファイル
|-- requirements.txt                 // 必要ライブラリ一覧
`-- src
    |-- bank_transfer_automation.py  // 自動操作処理
    `-- main.py                      // メイン処理
```

呼び出し用のメイン処理を作成しておきます。

```python:src/main.py
if __name__ == "__main__":
  # ログイン～振込の処理をだらだらと書く
```

ついでに bat ファイルを作成してワンクリックで実行できるようにします。

```bat:exe.bat
call .venv\Scripts\activate
python -m src.main
pause
```

これで bat ファイルを叩けば、自動で振り込みが行えるようになりました。実行結果例は以下の通りです。

![03.銀行自動振込_実行結果.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1681290/8891e113-14bd-0eae-07b6-fd923cbe891d.png)

ちなみに通知の仕組みは作成していません。振込を行った時、被振込側の銀行がメールで通知してくれるからです。


## さいごに

ここまでかなりの省力化ができました。とは言え、実行するためにわざわざ PC を立ち上げて bat を叩くという手間がまだ残っています。そこで、もっと楽をするために、作成した Python スクリプトを AWS 上にデプロイして定期実行するようにします。手順は次の記事にて記載する予定です。
